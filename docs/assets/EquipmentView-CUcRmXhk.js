import{d as R,r as c,h as U,o as X,a as Y,i as y,w as N,c as r,b as n,k as m,j as V,m as G,F,e as j,v as H,p as W,t as I,l as J,g as K,f as u,_ as Q}from"./index-C0Ghk3x6.js";import{I as Z}from"./ItemTooltip-DruyfLwU.js";const ee={class:"equipment-view"},te={class:"filters"},ae={class:"filter-group"},le=["value"],se={class:"filter-group"},ne={class:"equipment-container"},oe=["onMouseenter","onMouseleave"],re=["alt"],ue={class:"item-name-label"},ie={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},ce={key:1,class:"loading-indicator"},ve={key:2,class:"no-more"},de={key:3,class:"no-results"},pe={key:0},fe={key:0},me={key:1},ge={key:1},C=20,he=R({__name:"EquipmentView",setup(_e){const b={1:"面具",2:"上衣",3:"右手",4:"左手",5:"下装",6:"特殊",8:"鞋子",9:"头部"};let g=[];const v=c([]),s=c(""),l=c("all"),k=c(null),w=c(""),$=c(1),p=c(!1),d=c(!0),x=async()=>{if(!(g.length>0))try{g=await(await fetch("/Equip.json")).json()}catch(t){console.error("Failed to load all equipment data:",t)}},h=async(t=!1)=>{if(!p.value){p.value=!0;try{(t||v.value.length===0)&&(await x(),v.value=[],$.value=1,d.value=!0);const e=M(),a=($.value-1)*C,o=a+C,f=e.slice(a,o);t?v.value=f:v.value=[...v.value,...f],$.value++,d.value=o<e.length}catch(e){console.error("Failed to load equipment data:",e)}finally{p.value=!1}}},M=()=>{let t=g;if(l.value!=="all"){const e=Object.keys(b).find(a=>b[a]===l.value);e&&(t=t.filter(a=>a.Part.toString()===e))}return s.value&&(t=t.filter(e=>e.Name.toLowerCase().includes(s.value.toLowerCase()))),t},S=U(()=>s.value||l.value!=="all"?M():v.value);let E;const T=t=>{clearTimeout(E),E=setTimeout(async()=>{t||l.value!=="all"?g.length===0&&await h(!0):(await h(!0),await y(),_())},300)},A=async t=>{l.value=t,await T(s.value)},L=(t,e,a)=>{const f=`/images/${t.startsWith("Item")?t:`Item${t.substring(t.length-2)}`}.jpg`,D=32,z=-(a-1)*D,B=-(e-1)*D;return{width:"32px",height:"32px",backgroundImage:`url(${f})`,backgroundPosition:`${z}px ${B}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},q=(t,e)=>{const a=`${t.Name}_${t.Sheet}_${t.X}_${t.Y}_${t.Type}_${t.Part}`;return e!==void 0?`${a}_${e}`:a},P=(t,e,a)=>{a?(k.value=t,w.value=q(t,e)):(k.value=null,w.value="")};X(async()=>{await x(),h(!0),O()});let i=null;const O=()=>{i=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&d.value&&!p.value&&!s.value&&l.value==="all"&&h()})},{root:null,rootMargin:"200px",threshold:.1}),_(),Y(()=>{i&&i.disconnect()})},_=()=>{i&&(i.disconnect(),y(()=>{if(i&&!s.value&&l.value==="all"&&d.value){const t=document.querySelector(".infinite-scroll-trigger");t&&i.observe(t);const e=document.querySelector(".equipment-item:last-child");e&&i.observe(e)}}))};return N(()=>v.value.length,async()=>{await y(),_()}),N(()=>[s.value,l.value],async([t,e],[a,o])=>{(a&&!t||o!=="all"&&e==="all")&&!t&&e==="all"&&(await y(),_())}),(t,e)=>(u(),r("div",ee,[e[9]||(e[9]=n("h1",null,"装备表",-1)),n("div",te,[n("div",ae,[e[5]||(e[5]=n("label",{class:"filter-label"},"装备部位:",-1)),V(n("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),onChange:e[1]||(e[1]=a=>A(l.value)),class:"part-select"},[e[4]||(e[4]=n("option",{value:"all"},"全部部位",-1)),(u(),r(F,null,j(b,(a,o)=>n("option",{key:o,value:a},I(a),9,le)),64))],544),[[G,l.value]])]),n("div",se,[V(n("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.value=a),onInput:e[3]||(e[3]=a=>T(s.value)),type:"text",placeholder:"搜索装备名称...",class:"search-input"},null,544),[[H,s.value]])])]),n("div",ne,[(u(!0),r(F,null,j(S.value,(a,o)=>(u(),r("div",{key:q(a,o),class:"equipment-item"},[n("div",{class:"item-wrapper",onMouseenter:f=>P(a,o,!0),onMouseleave:f=>P(a,o,!1)},[n("div",{class:"item-icon",style:K(L(a.Sheet,a.X,a.Y)),alt:a.Name},null,12,re),n("div",ue,I(a.Name),1)],40,oe),J(Z,{item:k.value,visible:w.value===q(a,o)},null,8,["item","visible"])]))),128))]),!s.value&&l.value==="all"&&d.value?(u(),r("div",ie)):m("",!0),!s.value&&l.value==="all"&&d.value&&p.value?(u(),r("div",ce,[...e[6]||(e[6]=[n("div",{class:"loading-spinner"},null,-1),n("span",null,"加载更多...",-1)])])):m("",!0),!s.value&&l.value==="all"&&!d.value&&S.value.length>0?(u(),r("div",ve,[...e[7]||(e[7]=[n("span",null,"已加载全部数据",-1)])])):m("",!0),S.value.length===0&&!p.value?(u(),r("div",de,[s.value||l.value!=="all"?(u(),r("p",pe,[e[8]||(e[8]=W(" 未找到符合条件的装备 ",-1)),s.value?(u(),r("span",fe,' "'+I(s.value)+'"',1)):m("",!0),l.value!=="all"?(u(),r("span",me," ("+I(l.value)+")",1)):m("",!0)])):(u(),r("p",ge,"暂无数据"))])):m("",!0)]))}}),be=Q(he,[["__scopeId","data-v-608df737"]]);export{be as default};
