import{d as L,r as p,h as q,o as B,a as O,i as m,w as x,c as r,b as n,j as X,v as Y,k as y,F as V,e as C,t as S,n as A,l as R,g as U,f as i,_ as G}from"./index-C0Ghk3x6.js";import{I as H}from"./ItemTooltip-DruyfLwU.js";const W={class:"drops-view"},J={class:"filters"},K={class:"drops-container"},Q={class:"monster-name"},Z={class:"items-grid"},ee=["onMouseenter","onMouseleave"],te=["alt"],ae={class:"item-name-label"},se={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},oe={key:1,class:"loading-indicator"},le={key:2,class:"no-more"},ne={key:3,class:"no-results"},re={key:0},ie={key:1},E=20,ue=L({__name:"DropsView",setup(ce){let h=[];const c=p([]),o=p(""),w=p(null),b=p(""),k=p(1),f=p(!1),v=p(!0),N=async()=>{if(!(h.length>0))try{h=await(await fetch("/Drops.json")).json()}catch(e){console.error("Failed to load all drops data:",e)}},g=async(e=!1)=>{if(!f.value){f.value=!0;try{(e||c.value.length===0)&&(await N(),c.value=[],k.value=1,v.value=!0);const t=(k.value-1)*E,a=t+E,s=h.slice(t,a);e?c.value=s:c.value=[...c.value,...s],k.value++,v.value=a<h.length}catch(t){console.error("Failed to load drops data:",t)}finally{f.value=!1}}},$=q(()=>o.value?h.filter(e=>e.NpcName.toLowerCase().includes(o.value.toLowerCase())):c.value);let T;const P=e=>{clearTimeout(T),T=setTimeout(async()=>{e?h.length===0&&await g(!0):(await g(!0),await m(),_())},300)},j=(e,t,a)=>{const l=`/images/${e.startsWith("Item")?e:`Item${e.substring(e.length-2)}`}.jpg`,d=32,I=-(a-1)*d,F=-(t-1)*d;return{width:"32px",height:"32px",backgroundImage:`url(${l})`,backgroundPosition:`${I}px ${F}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},D=(e,t,a)=>{const s=`${e.Name}_${e.Sheet}_${e.X}_${e.Y}_${e.Type}`;return t!==void 0&&a!==void 0?`${s}_${t}_${a}`:s},M=(e,t,a,s)=>{s?(w.value=e,b.value=D(e,t,a)):(w.value=null,b.value="")};B(async()=>{await N(),g(!0),z()});let u=null;const z=()=>{u=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&v.value&&!f.value&&!o.value&&g()})},{root:null,rootMargin:"200px",threshold:.1}),_(),O(()=>{u&&u.disconnect()})},_=()=>{u&&(u.disconnect(),m(()=>{if(u&&!o.value&&v.value){const e=document.querySelector(".infinite-scroll-trigger");e&&u.observe(e);const t=document.querySelector(".drop-item:last-child");t&&u.observe(t)}}))};return x(()=>c.value.length,async()=>{await m(),_()}),x(()=>o.value,async(e,t)=>{t&&!e&&(await m(),_())}),(e,t)=>(i(),r("div",W,[t[4]||(t[4]=n("h1",null,"掉落表",-1)),n("div",J,[X(n("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),onInput:t[1]||(t[1]=a=>P(o.value)),type:"text",placeholder:"搜索怪物名称...",class:"search-input"},null,544),[[Y,o.value]])]),n("div",K,[(i(!0),r(V,null,C($.value,(a,s)=>(i(),r("div",{key:`${a.NpcName}_${s}`,class:"drop-item"},[n("div",Q,S(a.NpcName),1),n("div",Z,[(i(!0),r(V,null,C(a.DropItems,(l,d)=>(i(),r("div",{key:D(l,s,d),class:A(["item-container",{equipment:l.Type===3,gift:l.Type===2}])},[n("div",{class:"item-wrapper",onMouseenter:I=>M(l,s,d,!0),onMouseleave:I=>M(l,s,d,!1)},[n("div",{class:"item-icon",style:U(j(l.Sheet,l.X,l.Y)),alt:l.Name},null,12,te),n("div",ae,S(l.Name),1)],40,ee),R(H,{item:w.value,visible:b.value===D(l,s,d)},null,8,["item","visible"])],2))),128))])]))),128)),!o.value&&v.value?(i(),r("div",se)):y("",!0),!o.value&&v.value&&f.value?(i(),r("div",oe,[...t[2]||(t[2]=[n("div",{class:"loading-spinner"},null,-1),n("span",null,"加载更多...",-1)])])):y("",!0),!o.value&&!v.value&&$.value.length>0?(i(),r("div",le,[...t[3]||(t[3]=[n("span",null,"已加载全部数据",-1)])])):y("",!0),$.value.length===0&&!f.value?(i(),r("div",ne,[o.value?(i(),r("p",re,'未找到 "'+S(o.value)+'" 相关的怪物',1)):(i(),r("p",ie,"暂无数据"))])):y("",!0)])]))}}),pe=G(ue,[["__scopeId","data-v-1b8e92ee"]]);export{pe as default};
