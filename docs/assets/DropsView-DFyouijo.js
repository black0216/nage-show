import{d as j,r as c,q as B,o as O,a as X,s as y,v as C,c as r,e as n,x as Y,y as A,b as w,F as E,m as V,t as I,n as R,g as U,p as G,f as i}from"./vendor-ByJcA75B.js";import{I as H}from"./ItemTooltip-BUtbrFzq.js";import{_ as J}from"./index-CDARcPO2.js";const K={class:"drops-view"},Q={class:"filters"},W={class:"drops-container"},Z={class:"monster-name"},ee={class:"items-grid"},te=["onMouseenter","onMouseleave"],ae=["alt"],se={class:"item-name-label"},oe={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},le={key:1,class:"loading-indicator"},ne={key:2,class:"no-more"},re={key:3,class:"no-results"},ie={key:0},ue={key:1},L=20,ce=j({__name:"DropsView",setup(ve){let g=[];const v=c([]),l=c(""),b=c(null),k=c(""),$=c(null),D=c(1),h=c(!1),d=c(!0),N=async()=>{if(!(g.length>0))try{g=await(await fetch("/Drops.json")).json()}catch(t){console.error("Failed to load all drops data:",t)}},m=async(t=!1)=>{if(!h.value){h.value=!0;try{(t||v.value.length===0)&&(await N(),v.value=[],D.value=1,d.value=!0);const e=(D.value-1)*L,a=e+L,o=g.slice(e,a);t?v.value=o:v.value=[...v.value,...o],D.value++,d.value=a<g.length}catch(e){console.error("Failed to load drops data:",e)}finally{h.value=!1}}},S=B(()=>l.value?g.filter(t=>t.NpcName.toLowerCase().includes(l.value.toLowerCase())):v.value);let M;const P=t=>{clearTimeout(M),M=setTimeout(async()=>{t?g.length===0&&await m(!0):(await m(!0),await y(),_())},300)},q=(t,e,a)=>{const s=`/images/${t.toLowerCase()}.jpg`,p=32,f=-(a-1)*p,F=-(e-1)*p;return{width:"32px",height:"32px",backgroundImage:`url(${s})`,backgroundPosition:`${f}px ${F}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},T=(t,e,a)=>{const o=`${t.Name}_${t.Sheet}_${t.X}_${t.Y}_${t.Type}`;return e!==void 0&&a!==void 0?`${o}_${e}_${a}`:o},x=(t,e,a,o,s)=>{o&&s?.currentTarget?(b.value=t,k.value=T(t,e,a),$.value=s.currentTarget):(b.value=null,k.value="",$.value=null)};O(async()=>{await N(),m(!0),z()});let u=null;const z=()=>{u=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&d.value&&!h.value&&!l.value&&m()})},{root:null,rootMargin:"200px",threshold:.1}),_(),X(()=>{u&&u.disconnect()})},_=()=>{u&&(u.disconnect(),y(()=>{if(u&&!l.value&&d.value){const t=document.querySelector(".infinite-scroll-trigger");t&&u.observe(t);const e=document.querySelector(".drop-item:last-child");e&&u.observe(e)}}))};return C(()=>v.value.length,async()=>{await y(),_()}),C(()=>l.value,async(t,e)=>{e&&!t&&(await y(),_())}),(t,e)=>(i(),r("div",K,[e[4]||(e[4]=n("h1",null,"掉落表",-1)),n("div",Q,[Y(n("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),onInput:e[1]||(e[1]=a=>P(l.value)),type:"text",placeholder:"搜索怪物名称...",class:"search-input"},null,544),[[A,l.value]])]),n("div",W,[(i(!0),r(E,null,V(S.value,(a,o)=>(i(),r("div",{key:`${a.NpcName}_${o}`,class:"drop-item"},[n("div",Z,I(a.NpcName),1),n("div",ee,[(i(!0),r(E,null,V(a.DropItems,(s,p)=>(i(),r("div",{key:T(s,o,p),class:R(["item-container",{equipment:s.Type===3,gift:s.Type===2}])},[n("div",{class:"item-wrapper",onMouseenter:f=>x(s,o,p,!0,f),onMouseleave:f=>x(s,o,p,!1,f)},[n("div",{class:"item-icon",style:G(q(s.Sheet,s.X,s.Y)),alt:s.Name},null,12,ae),n("div",se,I(s.Name),1)],40,te),U(H,{item:b.value,visible:k.value===T(s,o,p),"trigger-element":$.value},null,8,["item","visible","trigger-element"])],2))),128))])]))),128)),!l.value&&d.value?(i(),r("div",oe)):w("",!0),!l.value&&d.value&&h.value?(i(),r("div",le,[...e[2]||(e[2]=[n("div",{class:"loading-spinner"},null,-1),n("span",null,"加载更多...",-1)])])):w("",!0),!l.value&&!d.value&&S.value.length>0?(i(),r("div",ne,[...e[3]||(e[3]=[n("span",null,"已加载全部数据",-1)])])):w("",!0),S.value.length===0&&!h.value?(i(),r("div",re,[l.value?(i(),r("p",ie,'未找到 "'+I(l.value)+'" 相关的怪物',1)):(i(),r("p",ue,"暂无数据"))])):w("",!0)])]))}}),he=J(ce,[["__scopeId","data-v-a48d731b"]]);export{he as default};
