import{d as K,r as c,q as Q,o as W,a as Z,s as k,v as A,c as r,e as n,b as g,x as T,z as F,F as j,m as L,u as ee,A as te,y as ae,i as le,t as h,g as ne,p as oe,f as i}from"./vendor-ByJcA75B.js";import{P,C as O,I as se}from"./ItemTooltip-BUtbrFzq.js";import{_ as ue}from"./index-CDARcPO2.js";const re={class:"equipment-view"},ie={class:"filters"},ve={class:"filter-group"},ce=["value"],de={class:"filter-group"},pe={class:"filter-group"},fe={class:"equipment-container"},ge=["onMouseenter","onMouseleave"],me=["alt"],he={class:"item-name-label"},ye={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},be={key:1,class:"loading-indicator"},_e={key:2,class:"no-more"},Ie={key:3,class:"no-results"},ke={key:0},qe={key:0},we={key:1},Se={key:2},Ee={key:1},R=20,$e=K({__name:"EquipmentView",setup(xe){let y=[];const p=c([]),o=c(""),s=c("all"),u=c("all"),q=c(null),w=c(""),S=c(null),E=c(1),m=c(!1),f=c(!0),N=async()=>{if(!(y.length>0))try{y=await(await fetch("/Equip.json")).json()}catch(t){console.error("Failed to load all equipment data:",t)}},b=async(t=!1)=>{if(!m.value){m.value=!0;try{(t||p.value.length===0)&&(await N(),p.value=[],E.value=1,f.value=!0);const e=V(),a=(E.value-1)*R,l=a+R,v=e.slice(a,l);t?p.value=v:p.value=[...p.value,...v],E.value++,f.value=l<e.length}catch(e){console.error("Failed to load equipment data:",e)}finally{m.value=!1}}},V=()=>{let t=y;if(s.value!=="all"){const e=Object.keys(P).find(a=>P[a]===s.value);e&&(t=t.filter(a=>a.Equip.Part.toString()===e))}if(u.value!=="all"){const e=z(u.value);t=t.filter(a=>{const l=a.Equip.NeedClass;return U(l,e)})}return o.value&&(t=t.filter(e=>e.Name.toLowerCase().includes(o.value.toLowerCase()))),t},z=t=>{const e={格斗:[0,101],舞械:[2,101],超能:[6,102],枪手:[7,102],不限:[100],"格斗/舞械":[101],"超能/枪手":[102]};for(const[l,v]of Object.entries(e))if(l===t)return v;const a=Object.keys(O).find(l=>O[parseInt(l)]===t);return a?[parseInt(a)]:[]},U=(t,e)=>e.length===0?!0:e.some(a=>{switch(a){case 100:return!0;case 101:return t===0||t===2||t===101;case 102:return t===6||t===7||t===102;default:return t===a}}),$=Q(()=>o.value||s.value!=="all"||u.value!=="all"?V():p.value);let D;const x=t=>{clearTimeout(D),D=setTimeout(async()=>{t||s.value!=="all"||u.value!=="all"?y.length===0&&await b(!0):(await b(!0),await k(),_())},300)},B=async t=>{s.value=t,await x(o.value)},X=async t=>{u.value=t,await x(o.value)},Y=(t,e,a)=>{const v=`/images/${t.toLowerCase()}.jpg`,I=32,H=-(a-1)*I,J=-(e-1)*I;return{width:"32px",height:"32px",backgroundImage:`url(${v})`,backgroundPosition:`${H}px ${J}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},M=(t,e)=>{const a=`${t.Name}_${t.Sheet}_${t.X}_${t.Y}_${t.Type}_${t.Equip.Part}`;return e!==void 0?`${a}_${e}`:a},C=(t,e,a,l)=>{a&&l?.currentTarget?(q.value=t,w.value=M(t,e),S.value=l.currentTarget):(q.value=null,w.value="",S.value=null)};W(async()=>{await N(),b(!0),G()});let d=null;const G=()=>{d=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&f.value&&!m.value&&!o.value&&s.value==="all"&&u.value==="all"&&b()})},{root:null,rootMargin:"200px",threshold:.1}),_(),Z(()=>{d&&d.disconnect()})},_=()=>{d&&(d.disconnect(),k(()=>{if(d&&!o.value&&s.value==="all"&&u.value==="all"&&f.value){const t=document.querySelector(".infinite-scroll-trigger");t&&d.observe(t);const e=document.querySelector(".equipment-item:last-child");e&&d.observe(e)}}))};return A(()=>p.value.length,async()=>{await k(),_()}),A(()=>[o.value,s.value,u.value],async([t,e,a],[l,v,I])=>{(l&&!t||v!=="all"&&e==="all"||I!=="all"&&a==="all")&&!t&&e==="all"&&a==="all"&&(await k(),_())}),(t,e)=>(i(),r("div",re,[e[13]||(e[13]=n("h1",null,"装备表",-1)),n("div",ie,[n("div",ve,[e[7]||(e[7]=n("label",{class:"filter-label"},"装备部位:",-1)),T(n("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),onChange:e[1]||(e[1]=a=>B(s.value)),class:"part-select"},[e[6]||(e[6]=n("option",{value:"all"},"全部部位",-1)),(i(!0),r(j,null,L(ee(P),(a,l)=>(i(),r("option",{key:l,value:a},h(a),9,ce))),128))],544),[[F,s.value]])]),n("div",de,[e[9]||(e[9]=n("label",{class:"filter-label"},"职业:",-1)),T(n("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),onChange:e[3]||(e[3]=a=>X(u.value)),class:"class-select"},[...e[8]||(e[8]=[te('<option value="all" data-v-6a40e64b>全部职业</option><option value="不限" data-v-6a40e64b>不限</option><option value="格斗" data-v-6a40e64b>格斗</option><option value="舞械" data-v-6a40e64b>舞械</option><option value="超能" data-v-6a40e64b>超能</option><option value="枪手" data-v-6a40e64b>枪手</option><option value="格斗/舞械" data-v-6a40e64b>格斗/舞械</option><option value="超能/枪手" data-v-6a40e64b>超能/枪手</option>',8)])],544),[[F,u.value]])]),n("div",pe,[T(n("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value=a),onInput:e[5]||(e[5]=a=>x(o.value)),type:"text",placeholder:"搜索装备名称...",class:"search-input"},null,544),[[ae,o.value]])])]),n("div",fe,[(i(!0),r(j,null,L($.value,(a,l)=>(i(),r("div",{key:M(a,l),class:"equipment-item"},[n("div",{class:"item-wrapper",onMouseenter:v=>C(a,l,!0,v),onMouseleave:v=>C(a,l,!1,v)},[n("div",{class:"item-icon",style:oe(Y(a.Sheet,a.X,a.Y)),alt:a.Name},null,12,me),n("div",he,h(a.Name),1)],40,ge),ne(se,{item:q.value,visible:w.value===M(a,l),"trigger-element":S.value},null,8,["item","visible","trigger-element"])]))),128))]),!o.value&&s.value==="all"&&u.value==="all"&&f.value?(i(),r("div",ye)):g("",!0),!o.value&&s.value==="all"&&u.value==="all"&&f.value&&m.value?(i(),r("div",be,[...e[10]||(e[10]=[n("div",{class:"loading-spinner"},null,-1),n("span",null,"加载更多...",-1)])])):g("",!0),!o.value&&s.value==="all"&&u.value==="all"&&!f.value&&$.value.length>0?(i(),r("div",_e,[...e[11]||(e[11]=[n("span",null,"已加载全部数据",-1)])])):g("",!0),$.value.length===0&&!m.value?(i(),r("div",Ie,[o.value||s.value!=="all"||u.value!=="all"?(i(),r("p",ke,[e[12]||(e[12]=le(" 未找到符合条件的装备 ",-1)),o.value?(i(),r("span",qe,' "'+h(o.value)+'"',1)):g("",!0),s.value!=="all"?(i(),r("span",we," ("+h(s.value)+")",1)):g("",!0),u.value!=="all"?(i(),r("span",Se," ("+h(u.value)+")",1)):g("",!0)])):(i(),r("p",Ee,"暂无数据"))])):g("",!0)]))}}),Ne=ue($e,[["__scopeId","data-v-6a40e64b"]]);export{Ne as default};
