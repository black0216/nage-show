import{d as G,r as d,b as q,e as O,f as Y,n as k,w as C,c as a,g as s,h as v,i as A,v as R,F as D,j as S,t as f,o as n,k as E,l as U,_ as X}from"./index-rcs-djj3.js";const W={class:"drops-view"},H={class:"filters"},J={class:"drops-container"},K={class:"monster-name"},Q={class:"items-grid"},Z=["onMouseenter"],ee=["alt"],te={class:"item-name-label"},se={class:"tooltip-header"},oe={class:"item-name"},ae={class:"item-type"},ne={key:0,class:"gift-contents"},le={class:"gift-items"},re={class:"gift-item-name"},ie={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},ce={key:1,class:"loading-indicator"},ue={key:2,class:"no-more"},de={key:3,class:"no-results"},ve={key:0},pe={key:1},V=20,he=G({__name:"DropsView",setup(fe){let p=[];const c=d([]),l=d(""),T=d(null),b=d(1),h=d(!1),u=d(!0),M=d(!1),N=async()=>{if(!(p.length>0))try{p=await(await fetch("/Drops.json")).json()}catch(t){console.error("Failed to load all drops data:",t)}},_=async(t=!1)=>{if(!h.value){h.value=!0;try{(t||c.value.length===0)&&(await N(),c.value=[],b.value=1,u.value=!0);const e=(b.value-1)*V,r=e+V,g=p.slice(e,r);t?c.value=g:c.value=[...c.value,...g],b.value++,u.value=r<p.length}catch(e){console.error("Failed to load drops data:",e)}finally{h.value=!1}}},x=q(()=>l.value?p.filter(t=>t.NpcName.toLowerCase().includes(l.value.toLowerCase())):c.value);let L;const j=t=>{clearTimeout(L),L=setTimeout(async()=>{t?p.length===0&&await _(!0):(await _(!0),await k(),w())},300)},B=(t,e,r)=>{const o=`/images/${t.startsWith("Item")?t:`Item${t.substring(t.length-2)}`}.jpg`,y=32,m=-(r-1)*y,I=-(e-1)*y;return{width:"32px",height:"32px",backgroundImage:`url(${o})`,backgroundPosition:`${m}px ${I}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},P=t=>{switch(t){case 1:return"普通道具";case 2:return"礼包";case 3:return"装备";default:return"未知"}},z=()=>{window.scrollTo({top:0,behavior:"smooth"})},$=()=>{M.value=window.scrollY>300};O(async()=>{await N(),_(!0),F(),window.addEventListener("scroll",$)});let i=null;const F=()=>{i=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&u.value&&!h.value&&!l.value&&_()})},{root:null,rootMargin:"200px",threshold:.1}),w(),Y(()=>{i&&i.disconnect(),window.removeEventListener("scroll",$)})},w=()=>{i&&(i.disconnect(),k(()=>{if(i&&!l.value&&u.value){const t=document.querySelector(".infinite-scroll-trigger");t&&i.observe(t);const e=document.querySelector(".drop-item:last-child");e&&i.observe(e)}}))};return C(()=>c.value.length,async()=>{await k(),w()}),C(()=>l.value,async(t,e)=>{e&&!t&&(await k(),w())}),(t,e)=>(n(),a("div",W,[e[7]||(e[7]=s("h1",null,"掉落表",-1)),s("div",H,[A(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r),onInput:e[1]||(e[1]=r=>j(l.value)),type:"text",placeholder:"搜索怪物名称...",class:"search-input"},null,544),[[R,l.value]])]),s("div",J,[(n(!0),a(D,null,S(x.value,(r,g)=>(n(),a("div",{key:g,class:"drop-item"},[s("div",K,f(r.NpcName),1),s("div",Q,[(n(!0),a(D,null,S(r.DropItems,(o,y)=>(n(),a("div",{key:y,class:E(["item-container",{equipment:o.Type===3,gift:o.Type===2}])},[s("div",{class:"item-wrapper",onMouseenter:m=>T.value=o,onMouseleave:e[2]||(e[2]=m=>T.value=null)},[s("div",{class:"item-icon",style:U(B(o.Sheet,o.X,o.Y)),alt:o.Name},null,12,ee),s("div",te,f(o.Name),1)],40,Z),T.value===o?(n(),a("div",{key:0,class:E(["tooltip",{"gift-tooltip":o.Type===2}])},[s("div",se,[s("span",oe,f(o.Name),1),s("span",ae,f(P(o.Type)),1)]),o.Type===2&&o.Gifts&&o.Gifts.length>0?(n(),a("div",ne,[e[3]||(e[3]=s("div",{class:"gift-title"},"礼包内容：",-1)),s("div",le,[(n(!0),a(D,null,S(o.Gifts,(m,I)=>(n(),a("div",{key:I,class:"gift-item"},[s("span",re,f(m),1)]))),128))])])):v("",!0)],2)):v("",!0)],2))),128))])]))),128)),!l.value&&u.value?(n(),a("div",ie)):v("",!0),!l.value&&u.value&&h.value?(n(),a("div",ce,[...e[4]||(e[4]=[s("div",{class:"loading-spinner"},null,-1),s("span",null,"加载更多...",-1)])])):v("",!0),!l.value&&!u.value&&x.value.length>0?(n(),a("div",ue,[...e[5]||(e[5]=[s("span",null,"已加载全部数据",-1)])])):v("",!0),x.value.length===0&&!h.value?(n(),a("div",de,[l.value?(n(),a("p",ve,'未找到 "'+f(l.value)+'" 相关的怪物',1)):(n(),a("p",pe,"暂无数据"))])):v("",!0)]),M.value?(n(),a("button",{key:0,onClick:z,class:"back-to-top",title:"返回顶部","aria-label":"返回顶部"},[...e[6]||(e[6]=[s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M12 19V5M5 12L12 5L19 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):v("",!0)]))}}),me=X(he,[["__scopeId","data-v-db6d78ff"]]);export{me as default};
