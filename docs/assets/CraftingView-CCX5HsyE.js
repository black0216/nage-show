import{d as x,r as c,h as E,o as P,a as z,i as M,w as F,c as i,b as a,j as O,v as R,k as $,F as U,e as G,t as w,n as k,l as p,g as B,f as r,_ as H}from"./index-C0Ghk3x6.js";import{I as A}from"./ItemTooltip-DruyfLwU.js";const W={class:"crafting-view"},J={class:"filters"},K={class:"crafting-container"},Q={class:"materials-section"},Z={class:"materials-grid"},ee={class:"material-container"},te=["onMouseenter","onMouseleave"],se=["alt"],ae={class:"item-name-label"},le={class:"material-container"},ne=["onMouseenter","onMouseleave"],oe=["alt"],ie={class:"item-name-label"},re={class:"material-container"},ue=["onMouseenter","onMouseleave"],ve=["alt"],me={class:"item-name-label"},de={class:"result-section"},ce={class:"result-container"},fe=["onMouseenter","onMouseleave"],Ie=["alt"],ge={class:"item-name-label"},he={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},_e={key:1,class:"loading-indicator"},we={key:2,class:"no-more"},ye={key:3,class:"no-results"},be={key:0},Ce={key:1},q=20,Me=x({__name:"CraftingView",setup($e){let f=[];const m=c([]),n=c(""),I=c(null),g=c(""),S=c(1),h=c(!1),d=c(!0),N=async()=>{if(!(f.length>0))try{f=await(await fetch("/Crafting.json")).json()}catch(s){console.error("Failed to load all crafting data:",s)}},y=async(s=!1)=>{if(!h.value){h.value=!0;try{(s||m.value.length===0)&&(await N(),m.value=[],S.value=1,d.value=!0);const t=(S.value-1)*q,e=t+q,l=f.slice(t,e);s?m.value=l:m.value=[...m.value,...l],S.value++,d.value=e<f.length}catch(t){console.error("Failed to load crafting data:",t)}finally{h.value=!1}}},T=E(()=>n.value?f.filter(s=>{const t=n.value.toLowerCase();return s.Item.Name.toLowerCase().includes(t)||s.ItemA.Name.toLowerCase().includes(t)||s.ItemB.Name.toLowerCase().includes(t)||s.ItemC.Name.toLowerCase().includes(t)}):m.value);let L;const V=s=>{clearTimeout(L),L=setTimeout(async()=>{s?f.length===0&&await y(!0):(await y(!0),await M(),C())},300)},b=(s,t,e)=>{const o=`/images/${s.startsWith("Item")?s:`Item${s.substring(s.length-2)}`}.jpg`,D=32,Y=-(e-1)*D,j=-(t-1)*D;return{width:"32px",height:"32px",backgroundImage:`url(${o})`,backgroundPosition:`${Y}px ${j}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},_=(s,t,e)=>{const l=`${s.Name}_${s.Sheet}_${s.X}_${s.Y}_${s.Type}`;return t!==void 0&&e!==void 0?`${l}_${t}_${e}`:l},u=(s,t,e,l)=>{l?(I.value=s,g.value=_(s,t,e)):(I.value=null,g.value="")};P(async()=>{await N(),y(!0),X()});let v=null;const X=()=>{v=new IntersectionObserver(s=>{s.forEach(t=>{t.isIntersecting&&d.value&&!h.value&&!n.value&&y()})},{root:null,rootMargin:"200px",threshold:.1}),C(),z(()=>{v&&v.disconnect()})},C=()=>{v&&(v.disconnect(),M(()=>{if(v&&!n.value&&d.value){const s=document.querySelector(".infinite-scroll-trigger");s&&v.observe(s);const t=document.querySelector(".crafting-item:last-child");t&&v.observe(t)}}))};return F(()=>m.value.length,async()=>{await M(),C()}),F(()=>n.value,async(s,t)=>{t&&!s&&(await M(),C())}),(s,t)=>(r(),i("div",W,[t[10]||(t[10]=a("h1",null,"合成表",-1)),a("div",J,[O(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),onInput:t[1]||(t[1]=e=>V(n.value)),type:"text",placeholder:"搜索道具名称...",class:"search-input"},null,544),[[R,n.value]])]),a("div",K,[(r(!0),i(U,null,G(T.value,(e,l)=>(r(),i("div",{key:l,class:"crafting-item"},[a("div",Q,[t[5]||(t[5]=a("div",{class:"section-title"},"合成材料",-1)),a("div",Z,[a("div",ee,[t[2]||(t[2]=a("div",{class:"slot-label"},"A槽",-1)),a("div",{class:k(["item-wrapper",{equipment:e.ItemA.Type===3,gift:e.ItemA.Type===2}]),onMouseenter:o=>u(e.ItemA,l,"A",!0),onMouseleave:o=>u(e.ItemA,l,"A",!1)},[a("div",{class:"item-icon",style:B(b(e.ItemA.Sheet,e.ItemA.X,e.ItemA.Y)),alt:e.ItemA.Name},null,12,se),a("div",ae,w(e.ItemA.Name),1),p(A,{item:I.value,visible:g.value===_(e.ItemA,l,"A")},null,8,["item","visible"])],42,te)]),a("div",le,[t[3]||(t[3]=a("div",{class:"slot-label"},"B槽",-1)),a("div",{class:k(["item-wrapper",{equipment:e.ItemB.Type===3,gift:e.ItemB.Type===2}]),onMouseenter:o=>u(e.ItemB,l,"B",!0),onMouseleave:o=>u(e.ItemB,l,"B",!1)},[a("div",{class:"item-icon",style:B(b(e.ItemB.Sheet,e.ItemB.X,e.ItemB.Y)),alt:e.ItemB.Name},null,12,oe),a("div",ie,w(e.ItemB.Name),1),p(A,{item:I.value,visible:g.value===_(e.ItemB,l,"B")},null,8,["item","visible"])],42,ne)]),a("div",re,[t[4]||(t[4]=a("div",{class:"slot-label"},"C槽",-1)),a("div",{class:k(["item-wrapper",{equipment:e.ItemC.Type===3,gift:e.ItemC.Type===2}]),onMouseenter:o=>u(e.ItemC,l,"C",!0),onMouseleave:o=>u(e.ItemC,l,"C",!1)},[a("div",{class:"item-icon",style:B(b(e.ItemC.Sheet,e.ItemC.X,e.ItemC.Y)),alt:e.ItemC.Name},null,12,ve),a("div",me,w(e.ItemC.Name),1),p(A,{item:I.value,visible:g.value===_(e.ItemC,l,"C")},null,8,["item","visible"])],42,ue)])])]),t[7]||(t[7]=a("div",{class:"crafting-arrow"},[a("svg",{width:"40",height:"40",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M20 8L32 20L20 32",stroke:"#ffd700","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),a("div",de,[t[6]||(t[6]=a("div",{class:"section-title"},"合成结果",-1)),a("div",ce,[a("div",{class:k(["item-wrapper",{equipment:e.Item.Type===3,gift:e.Item.Type===2}]),onMouseenter:o=>u(e.Item,l,"Final",!0),onMouseleave:o=>u(e.Item,l,"Final",!1)},[a("div",{class:"item-icon result-icon",style:B(b(e.Item.Sheet,e.Item.X,e.Item.Y)),alt:e.Item.Name},null,12,Ie),a("div",ge,w(e.Item.Name),1),p(A,{item:I.value,visible:g.value===_(e.Item,l,"Final")},null,8,["item","visible"])],42,fe)])])]))),128)),!n.value&&d.value?(r(),i("div",he)):$("",!0),!n.value&&d.value&&h.value?(r(),i("div",_e,[...t[8]||(t[8]=[a("div",{class:"loading-spinner"},null,-1),a("span",null,"加载更多...",-1)])])):$("",!0),!n.value&&!d.value&&T.value.length>0?(r(),i("div",we,[...t[9]||(t[9]=[a("span",null,"已加载全部数据",-1)])])):$("",!0),T.value.length===0&&!h.value?(r(),i("div",ye,[n.value?(r(),i("p",be,'未找到 "'+w(n.value)+'" 相关的合成配方',1)):(r(),i("p",Ce,"暂无数据"))])):$("",!0)])]))}}),Be=H(Me,[["__scopeId","data-v-9ab575c2"]]);export{Be as default};
