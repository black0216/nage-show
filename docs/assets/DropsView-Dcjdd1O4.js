import{d as F,r as p,h as q,o as B,a as O,i as m,w as x,c as r,b as n,j as X,v as Y,k as y,F as C,e as V,t as I,n as A,l as R,g as U,f as i,_ as G}from"./index-DawpKkBg.js";import{I as H}from"./ItemTooltip-DbTG54MC.js";const J={class:"drops-view"},K={class:"filters"},Q={class:"drops-container"},W={class:"monster-name"},Z={class:"items-grid"},ee=["onMouseenter","onMouseleave"],te=["alt"],ae={class:"item-name-label"},se={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},oe={key:1,class:"loading-indicator"},le={key:2,class:"no-more"},ne={key:3,class:"no-results"},re={key:0},ie={key:1},E=20,ue=F({__name:"DropsView",setup(ce){let h=[];const c=p([]),o=p(""),w=p(null),k=p(""),b=p(1),f=p(!1),v=p(!0),N=async()=>{if(!(h.length>0))try{h=await(await fetch("/Drops.json")).json()}catch(t){console.error("Failed to load all drops data:",t)}},_=async(t=!1)=>{if(!f.value){f.value=!0;try{(t||c.value.length===0)&&(await N(),c.value=[],b.value=1,v.value=!0);const e=(b.value-1)*E,a=e+E,s=h.slice(e,a);t?c.value=s:c.value=[...c.value,...s],b.value++,v.value=a<h.length}catch(e){console.error("Failed to load drops data:",e)}finally{f.value=!1}}},$=q(()=>o.value?h.filter(t=>t.NpcName.toLowerCase().includes(o.value.toLowerCase())):c.value);let T;const L=t=>{clearTimeout(T),T=setTimeout(async()=>{t?h.length===0&&await _(!0):(await _(!0),await m(),g())},300)},P=(t,e,a)=>{const l=`/images/${t.toLowerCase()}.jpg`,d=32,S=-(a-1)*d,z=-(e-1)*d;return{width:"32px",height:"32px",backgroundImage:`url(${l})`,backgroundPosition:`${S}px ${z}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},D=(t,e,a)=>{const s=`${t.Name}_${t.Sheet}_${t.X}_${t.Y}_${t.Type}`;return e!==void 0&&a!==void 0?`${s}_${e}_${a}`:s},M=(t,e,a,s)=>{s?(w.value=t,k.value=D(t,e,a)):(w.value=null,k.value="")};B(async()=>{await N(),_(!0),j()});let u=null;const j=()=>{u=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&v.value&&!f.value&&!o.value&&_()})},{root:null,rootMargin:"200px",threshold:.1}),g(),O(()=>{u&&u.disconnect()})},g=()=>{u&&(u.disconnect(),m(()=>{if(u&&!o.value&&v.value){const t=document.querySelector(".infinite-scroll-trigger");t&&u.observe(t);const e=document.querySelector(".drop-item:last-child");e&&u.observe(e)}}))};return x(()=>c.value.length,async()=>{await m(),g()}),x(()=>o.value,async(t,e)=>{e&&!t&&(await m(),g())}),(t,e)=>(i(),r("div",J,[e[4]||(e[4]=n("h1",null,"掉落表",-1)),n("div",K,[X(n("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),onInput:e[1]||(e[1]=a=>L(o.value)),type:"text",placeholder:"搜索怪物名称...",class:"search-input"},null,544),[[Y,o.value]])]),n("div",Q,[(i(!0),r(C,null,V($.value,(a,s)=>(i(),r("div",{key:`${a.NpcName}_${s}`,class:"drop-item"},[n("div",W,I(a.NpcName),1),n("div",Z,[(i(!0),r(C,null,V(a.DropItems,(l,d)=>(i(),r("div",{key:D(l,s,d),class:A(["item-container",{equipment:l.Type===3,gift:l.Type===2}])},[n("div",{class:"item-wrapper",onMouseenter:S=>M(l,s,d,!0),onMouseleave:S=>M(l,s,d,!1)},[n("div",{class:"item-icon",style:U(P(l.Sheet,l.X,l.Y)),alt:l.Name},null,12,te),n("div",ae,I(l.Name),1)],40,ee),R(H,{item:w.value,visible:k.value===D(l,s,d)},null,8,["item","visible"])],2))),128))])]))),128)),!o.value&&v.value?(i(),r("div",se)):y("",!0),!o.value&&v.value&&f.value?(i(),r("div",oe,[...e[2]||(e[2]=[n("div",{class:"loading-spinner"},null,-1),n("span",null,"加载更多...",-1)])])):y("",!0),!o.value&&!v.value&&$.value.length>0?(i(),r("div",le,[...e[3]||(e[3]=[n("span",null,"已加载全部数据",-1)])])):y("",!0),$.value.length===0&&!f.value?(i(),r("div",ne,[o.value?(i(),r("p",re,'未找到 "'+I(o.value)+'" 相关的怪物',1)):(i(),r("p",ie,"暂无数据"))])):y("",!0)])]))}}),pe=G(ue,[["__scopeId","data-v-fc9ba674"]]);export{pe as default};
