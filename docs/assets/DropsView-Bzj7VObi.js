import{d as Y,r as c,p as A,o as R,a as G,q as y,s as M,c as i,e as n,v as E,x as P,b as T,F as q,m as z,t as w,y as H,g as J,n as K,f as u}from"./vendor-Nwz7H2ua.js";import{I as Q}from"./ItemTooltip-DFpcMMWy.js";import{_ as W}from"./index-CfIct3jf.js";const Z={class:"drops-view"},ee={class:"filters"},te={class:"search-container"},ae={class:"drops-container"},se={class:"monster-name"},le={class:"items-grid"},oe=["onMouseenter","onMouseleave"],ne=["alt"],re={class:"item-name-label"},ie={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},ue={key:1,class:"loading-indicator"},ce={key:2,class:"no-more"},ve={key:3,class:"no-results"},de={key:0},pe={key:1},he={key:2},me={key:3},F=20,fe=Y({__name:"DropsView",setup(ge){let d=[];const p=c([]),s=c(""),r=c(""),D=c(null),S=c(""),b=c(null),$=c(1),f=c(!1),h=c(!0),x=async()=>{if(!(d.length>0))try{d=await(await fetch("/Drops.json")).json()}catch(t){console.error("Failed to load all drops data:",t)}},g=async(t=!1)=>{if(!f.value){f.value=!0;try{(t||p.value.length===0)&&(await x(),p.value=[],$.value=1,h.value=!0);const e=($.value-1)*F,a=e+F,o=d.slice(e,a);t?p.value=o:p.value=[...p.value,...o],$.value++,h.value=a<d.length}catch(e){console.error("Failed to load drops data:",e)}finally{f.value=!1}}},I=A(()=>{let t;return s.value||r.value?t=d:t=p.value,s.value&&(t=t.filter(e=>e.NpcName.toLowerCase().includes(s.value.toLowerCase()))),r.value&&(t=t.filter(e=>e.DropItems.some(a=>a.Name.toLowerCase().includes(r.value.toLowerCase())))),t});let C;const j=async t=>{clearTimeout(C),C=setTimeout(async()=>{t||r.value?d.length===0&&await g(!0):(await g(!0),await y(),_())},300)};let L;const B=async t=>{clearTimeout(L),L=setTimeout(async()=>{t||s.value?d.length===0&&await g(!0):(await g(!0),await y(),_())},300)},O=(t,e,a)=>{const l=`/images/${t.toLowerCase()}.jpg`,m=32,k=-(a-1)*m,X=-(e-1)*m;return{width:"32px",height:"32px",backgroundImage:`url(${l})`,backgroundPosition:`${k}px ${X}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},N=(t,e,a)=>{const o=`${t.Name}_${t.Sheet}_${t.X}_${t.Y}_${t.Type}`;return e!==void 0&&a!==void 0?`${o}_${e}_${a}`:o},V=(t,e,a,o,l)=>{o&&l?.currentTarget?(D.value=t,S.value=N(t,e,a),b.value=l.currentTarget):(D.value=null,S.value="",b.value=null)};R(async()=>{await x(),g(!0),U()});let v=null;const U=()=>{v=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&h.value&&!f.value&&!s.value&&g()})},{root:null,rootMargin:"200px",threshold:.1}),_(),G(()=>{v&&v.disconnect()})},_=()=>{v&&(v.disconnect(),y(()=>{if(v&&!s.value&&h.value){const t=document.querySelector(".infinite-scroll-trigger");t&&v.observe(t);const e=document.querySelector(".drop-item:last-child");e&&v.observe(e)}}))};return M(()=>p.value.length,async()=>{await y(),_()}),M(()=>s.value,async(t,e)=>{e&&!t&&!r.value&&(await y(),_())}),M(()=>r.value,async(t,e)=>{e&&!t&&!s.value&&(await y(),_())}),(t,e)=>(u(),i("div",Z,[e[6]||(e[6]=n("h1",null,"掉落表",-1)),n("div",ee,[n("div",te,[E(n("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),onInput:e[1]||(e[1]=a=>j(s.value)),type:"text",placeholder:"搜索怪物名称...",class:"search-input"},null,544),[[P,s.value]]),E(n("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a),onInput:e[3]||(e[3]=a=>B(r.value)),type:"text",placeholder:"搜索道具名称...",class:"search-input"},null,544),[[P,r.value]])])]),n("div",ae,[(u(!0),i(q,null,z(I.value,(a,o)=>(u(),i("div",{key:`${a.NpcName}_${o}`,class:"drop-item"},[n("div",se,w(a.NpcName),1),n("div",le,[(u(!0),i(q,null,z(a.DropItems,(l,m)=>(u(),i("div",{key:N(l,o,m),class:H(["item-container",{equipment:l.Type===3,gift:l.Type===2}])},[n("div",{class:"item-wrapper",onMouseenter:k=>V(l,o,m,!0,k),onMouseleave:k=>V(l,o,m,!1,k)},[n("div",{class:"item-icon",style:K(O(l.Sheet,l.X,l.Y)),alt:l.Name},null,12,ne),n("div",re,w(l.Name),1)],40,oe),J(Q,{item:D.value,visible:S.value===N(l,o,m),"trigger-element":b.value},null,8,["item","visible","trigger-element"])],2))),128))])]))),128)),!s.value&&h.value?(u(),i("div",ie)):T("",!0),!s.value&&h.value&&f.value?(u(),i("div",ue,[...e[4]||(e[4]=[n("div",{class:"loading-spinner"},null,-1),n("span",null,"加载更多...",-1)])])):T("",!0),!s.value&&!h.value&&I.value.length>0?(u(),i("div",ce,[...e[5]||(e[5]=[n("span",null,"已加载全部数据",-1)])])):T("",!0),I.value.length===0&&!f.value?(u(),i("div",ve,[s.value&&r.value?(u(),i("p",de,'未找到 "'+w(s.value)+'" 和 "'+w(r.value)+'" 相关的结果',1)):s.value?(u(),i("p",pe,'未找到 "'+w(s.value)+'" 相关的怪物',1)):r.value?(u(),i("p",he,'未找到掉落 "'+w(r.value)+'" 的怪物',1)):(u(),i("p",me,"暂无数据"))])):T("",!0)])]))}}),ke=W(fe,[["__scopeId","data-v-26857721"]]);export{ke as default};
