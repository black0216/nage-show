import{d as B,c as o,b as p,o as n,n as j,e as s,t as g,F as $,r as D,_ as P,f as m,g as Y,h as A,i as R,j as T,w as E,k as U,v as X,l as H,m as W}from"./index-dprsMS_3.js";const J={class:"tooltip-header"},K={class:"item-name"},Q={class:"item-type"},Z={key:0,class:"gift-contents"},ee={class:"gift-items"},te={class:"gift-item-name"},se=B({__name:"ItemTooltip",props:{item:{default:null},visible:{type:Boolean,default:!1}},setup(r){const u=c=>{switch(c){case 1:return"普通道具";case 2:return"礼包";case 3:return"装备";default:return"未知"}};return(c,a)=>r.visible&&r.item?(n(),o("div",{key:0,class:j(["item-tooltip",{"gift-tooltip":r.item.Type===2}])},[s("div",J,[s("span",K,g(r.item.Name),1),s("span",Q,g(u(r.item.Type)),1)]),r.item.Type===2&&r.item.Gifts&&r.item.Gifts.length>0?(n(),o("div",Z,[a[0]||(a[0]=s("div",{class:"gift-title"},"礼包内容：",-1)),s("div",ee,[(n(!0),o($,null,D(r.item.Gifts,(f,w)=>(n(),o("div",{key:w,class:"gift-item"},[s("span",te,g(f),1)]))),128))])])):p("",!0)],2)):p("",!0)}}),ae=P(se,[["__scopeId","data-v-64dfbcdb"]]),oe={class:"drops-view"},ne={class:"filters"},le={class:"drops-container"},ie={class:"monster-name"},re={class:"items-grid"},ce=["onMouseenter","onMouseleave"],ue=["alt"],de={class:"item-name-label"},ve={key:0,class:"infinite-scroll-trigger",style:{height:"1px",width:"100%"}},me={key:1,class:"loading-indicator"},pe={key:2,class:"no-more"},fe={key:3,class:"no-results"},he={key:0},ge={key:1},V=20,we=B({__name:"DropsView",setup(r){let u=[];const c=m([]),a=m(""),f=m(null),w=m(1),h=m(!1),v=m(!0),S=m(!1),M=async()=>{if(!(u.length>0))try{u=await(await fetch("/Drops.json")).json()}catch(t){console.error("Failed to load all drops data:",t)}},_=async(t=!1)=>{if(!h.value){h.value=!0;try{(t||c.value.length===0)&&(await M(),c.value=[],w.value=1,v.value=!0);const e=(w.value-1)*V,i=e+V,y=u.slice(e,i);t?c.value=y:c.value=[...c.value,...y],w.value++,v.value=i<u.length}catch(e){console.error("Failed to load drops data:",e)}finally{h.value=!1}}},x=Y(()=>a.value?u.filter(t=>t.NpcName.toLowerCase().includes(a.value.toLowerCase())):c.value);let N;const z=t=>{clearTimeout(N),N=setTimeout(async()=>{t?u.length===0&&await _(!0):(await _(!0),await T(),k())},300)},F=(t,e,i)=>{const l=`/images/${t.startsWith("Item")?t:`Item${t.substring(t.length-2)}`}.jpg`,b=32,I=-(i-1)*b,O=-(e-1)*b;return{width:"32px",height:"32px",backgroundImage:`url(${l})`,backgroundPosition:`${I}px ${O}px`,backgroundSize:"256px 256px",backgroundRepeat:"no-repeat"}},L=(t,e)=>{e?f.value=t:f.value=null},G=()=>{window.scrollTo({top:0,behavior:"smooth"})},C=()=>{S.value=window.scrollY>300};A(async()=>{await M(),_(!0),q(),window.addEventListener("scroll",C)});let d=null;const q=()=>{d=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&v.value&&!h.value&&!a.value&&_()})},{root:null,rootMargin:"200px",threshold:.1}),k(),R(()=>{d&&d.disconnect(),window.removeEventListener("scroll",C)})},k=()=>{d&&(d.disconnect(),T(()=>{if(d&&!a.value&&v.value){const t=document.querySelector(".infinite-scroll-trigger");t&&d.observe(t);const e=document.querySelector(".drop-item:last-child");e&&d.observe(e)}}))};return E(()=>c.value.length,async()=>{await T(),k()}),E(()=>a.value,async(t,e)=>{e&&!t&&(await T(),k())}),(t,e)=>(n(),o("div",oe,[e[5]||(e[5]=s("h1",null,"掉落表",-1)),s("div",ne,[U(s("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>a.value=i),onInput:e[1]||(e[1]=i=>z(a.value)),type:"text",placeholder:"搜索怪物名称...",class:"search-input"},null,544),[[X,a.value]])]),s("div",le,[(n(!0),o($,null,D(x.value,(i,y)=>(n(),o("div",{key:`${i.NpcName}_${y}`,class:"drop-item"},[s("div",ie,g(i.NpcName),1),s("div",re,[(n(!0),o($,null,D(i.DropItems,(l,b)=>(n(),o("div",{key:b,class:j(["item-container",{equipment:l.Type===3,gift:l.Type===2}])},[s("div",{class:"item-wrapper",onMouseenter:I=>L(l,!0),onMouseleave:I=>L(l,!1)},[s("div",{class:"item-icon",style:W(F(l.Sheet,l.X,l.Y)),alt:l.Name},null,12,ue),s("div",de,g(l.Name),1)],40,ce),H(ae,{item:f.value,visible:f.value===l},null,8,["item","visible"])],2))),128))])]))),128)),!a.value&&v.value?(n(),o("div",ve)):p("",!0),!a.value&&v.value&&h.value?(n(),o("div",me,[...e[2]||(e[2]=[s("div",{class:"loading-spinner"},null,-1),s("span",null,"加载更多...",-1)])])):p("",!0),!a.value&&!v.value&&x.value.length>0?(n(),o("div",pe,[...e[3]||(e[3]=[s("span",null,"已加载全部数据",-1)])])):p("",!0),x.value.length===0&&!h.value?(n(),o("div",fe,[a.value?(n(),o("p",he,'未找到 "'+g(a.value)+'" 相关的怪物',1)):(n(),o("p",ge,"暂无数据"))])):p("",!0)]),S.value?(n(),o("button",{key:0,onClick:G,class:"back-to-top",title:"返回顶部","aria-label":"返回顶部"},[...e[4]||(e[4]=[s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M12 19V5M5 12L12 5L19 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):p("",!0)]))}}),_e=P(we,[["__scopeId","data-v-a20af8e5"]]);export{_e as default};
